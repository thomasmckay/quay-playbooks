---
- name: Pull latest image
  shell:
    cmd: |
      docker pull quay.io/thomasmckay/quay:rhel7

- name: Quay Config container
  docker_container:
    name: quay-config
    image: quay.io/thomasmckay/quay:rhel7
    volumes:
      - ~/quay-config:/conf/stack
      - ~/quay-storage:/datastorage
    env:
      QUAYENTRY: config
      CONFIG_APP_PASSWORD: password
    ports:
      - "8080:8080"
      - "8443:8443"
    keep_volumes: false
    auto_remove: true
    state: started
    restart: true
  register: result
  until: result is succeeded
  retries: 5
  delay: 10
